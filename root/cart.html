<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VillageMart - Cart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <header class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-20">
            <a href="index.html" class="text-3xl font-extrabold text-lime-600">VillageMart</a>
            <h2 class="text-xl font-bold text-gray-800">Cart & Billing</h2>
            <button onclick="window.location.href='index.html'" class="btn-secondary px-6 py-2 rounded-full font-semibold text-gray-800">Continue Shopping</button>
        </div>
    </header>
    <main class="flex-1 container mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Your Cart</h2>
            <div id="cart-items-section"></div>
            <div id="min-order-banner" class="my-6 text-center text-base font-semibold py-2 rounded-lg"></div>
            <div class="mt-8 border-t pt-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Bill Summary</h3>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">Subtotal</span>
                    <span id="cart-subtotal" class="font-bold text-gray-900">₹0.00</span>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">Delivery</span>
                    <span class="text-gray-500">Free</span>
                </div>
                <div class="flex justify-between items-center text-lg font-bold border-t pt-2">
                    <span>Total</span>
                    <span id="cart-total">₹0.00</span>
                </div>
            </div>
            <button id="order-btn" class="btn-primary w-full mt-6 py-3 rounded-lg text-white font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed">Order</button>
            <button id="pay-btn" class="btn-primary w-full mt-4 py-3 rounded-lg text-white font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed">Click to Pay</button>
            <!-- Bill Receipt Modal -->
            <div id="bill-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-8 relative">
                    <button id="close-bill-modal" class="absolute top-4 right-4 text-gray-500 hover:text-red-500"><i data-lucide="x" class="h-6 w-6"></i></button>
                    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Bill Receipt</h2>
                    <div id="bill-details"></div>
                </div>
            </div>
            <!-- Removed Click to Pay Button at Bottom -->
        </div>
    </main>
    <script>
        lucide.createIcons();
        const cart = JSON.parse(localStorage.getItem('cart') || '{}');
        const cartItemsSection = document.getElementById('cart-items-section');
        const cartSubtotal = document.getElementById('cart-subtotal');
        const cartTotal = document.getElementById('cart-total');
        const checkoutBtn = document.getElementById('checkout-btn');
        const minOrderMsg = document.getElementById('min-order-msg');
        const MIN_ORDER = 3000;
        const minOrderBanner = document.getElementById('min-order-banner');
        function renderCart() {
            let total = 0;
            let hasItems = false;
            let html = '';
            for (const id in cart) {
                hasItems = true;
                const item = cart[id];
                total += item.price * item.qty;
                html += `
                <div class='flex items-center justify-between border-b py-4'>
                    <div>
                        <div class='font-semibold text-gray-800'>${item.name}</div>
                        <div class='text-sm text-gray-500'>₹${item.price} x ${item.qty}</div>
                    </div>
                    <div class='flex items-center space-x-2'>
                        <button class='text-lime-600 font-bold text-lg px-3 py-1 border border-lime-600 rounded-full bg-white' onclick='changeQty("${id}", -1)'>-</button>
                        <span class='font-semibold text-gray-800'>${item.qty}</span>
                        <button class='text-lime-600 font-bold text-lg px-3 py-1 border border-lime-600 rounded-full bg-white' onclick='changeQty("${id}", 1)'>+</button>
                        <button class='text-red-500 ml-2' onclick='removeItem("${id}")'><i data-lucide="trash-2" class="h-5 w-5"></i></button>
                    </div>
                </div>`;
            }
            cartItemsSection.innerHTML = hasItems ? html : '<div class="text-gray-400 text-center">Your cart is empty.</div>';
            cartSubtotal.textContent = `₹${total.toLocaleString('en-IN', {minimumFractionDigits:2})}`;
            cartTotal.textContent = `₹${total.toLocaleString('en-IN', {minimumFractionDigits:2})}`;
            // Minimum order logic
            const minOrderBanner = document.getElementById('min-order-banner');
            const orderBtn = document.getElementById('order-btn');
            const payBtn = document.getElementById('pay-btn');
            if (total >= 3000 && hasItems) {
                orderBtn.disabled = false;
                payBtn.disabled = false;
                minOrderBanner.textContent = 'You have reached the minimum order value (₹3000). You can place your order.';
                minOrderBanner.className = 'my-6 text-center text-base font-semibold py-2 rounded-lg bg-green-100 text-green-700';
            } else {
                orderBtn.disabled = true;
                payBtn.disabled = true;
                minOrderBanner.textContent = 'Minimum order value is ₹3000 to place an order.';
                minOrderBanner.className = 'my-6 text-center text-base font-semibold py-2 rounded-lg bg-red-100 text-red-700';
            }
            lucide.createIcons();
        }
        window.changeQty = function(id, delta) {
            if (cart[id]) {
                cart[id].qty += delta;
                if (cart[id].qty <= 0) {
                    delete cart[id];
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                renderCart();
            }
        }
        window.removeItem = function(id) {
            if (cart[id]) {
                delete cart[id];
                localStorage.setItem('cart', JSON.stringify(cart));
                renderCart();
            }
        }
        renderCart();
        checkoutBtn.onclick = function() {
            alert('Proceeding to payment (mock). Implement payment gateway here.');
        }
        // Bill Receipt Modal logic
        const billModal = document.getElementById('bill-modal');
        const closeBillModal = document.getElementById('close-bill-modal');
        const viewBillBtn = document.getElementById('view-bill-btn');
        const billDetails = document.getElementById('bill-details');
        viewBillBtn.onclick = function() {
            let html = '<table class="w-full text-left mb-4"><thead><tr><th class="py-2">Item</th><th class="py-2">Qty</th><th class="py-2">Price</th><th class="py-2">Subtotal</th></tr></thead><tbody>';
            let total = 0;
            for (const id in cart) {
                const item = cart[id];
                const subtotal = item.price * item.qty;
                html += `<tr><td class="py-1">${item.name}</td><td class="py-1">${item.qty}</td><td class="py-1">₹${item.price.toLocaleString('en-IN', {minimumFractionDigits:2})}</td><td class="py-1">₹${subtotal.toLocaleString('en-IN', {minimumFractionDigits:2})}</td></tr>`;
                total += subtotal;
            }
            html += `</tbody></table><div class="flex justify-between font-bold text-lg border-t pt-2"><span>Total</span><span>₹${total.toLocaleString('en-IN', {minimumFractionDigits:2})}</span></div>`;
            billDetails.innerHTML = html;
            billModal.classList.remove('hidden');
        };
        closeBillModal.onclick = function() {
            billModal.classList.add('hidden');
        };
        // Order and Pay button logic
        const orderBtn = document.getElementById('order-btn');
        const payBtn = document.getElementById('pay-btn');
        orderBtn.onclick = function() {
            if (!orderBtn.disabled) payBtn.scrollIntoView({behavior:'smooth'});
        };
        payBtn.onclick = function() {
            if (!payBtn.disabled) {
                alert('Proceeding to payment (mock). Implement payment gateway here.');
            }
        };
    </script>
</body>
</html>
